<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIR QUALITY MONITORING SYSTEM</title>
    
    <link rel="icon" type="image/x-icon" href="logo.png'">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

 <!-- Latest compiled and minified CSS -->
 <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
   
<!-- jQuery must be loaded first -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>
<!-- <link rel="stylesheet" href="{{ asset('css/style.css') }}"> -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.3/mqttws31.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/billboard.js/dist/billboard.min.css">
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/billboard.js/dist/billboard.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #1d1d1d;
            color: #fff;
        }
        .chart {
            width: 300px;
            height: 300px;
            margin: 20px;
        }
        .chart-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px;
        }
        .header {
            background-color: #1d1d1d;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #fff;
        }

        .header-content {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
        }

        .logo {
            height: 40px;
            margin-right: 10px;
        }

        .company-name {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
        }

        .user-section {
            display: flex;
            align-items: center;
        }

        .user-dropdown {
            position: relative;
            display: inline-block;
        }

        .username {
            cursor: pointer;
            color: #fff;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
            color: #333;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }

        .user-dropdown:hover .dropdown-content {
            display: block;
        }

        .container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 50px auto;
        }

        .circle {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid #fff;
            padding-bottom: 10px; /* Add padding to create space for the name */
        }

        .circle .value {
            font-size: 20px;
            text-align: center;
        }

        .circle .name {
            font-size: 14px;
            text-align: center;
            margin-top: 5px; /* Ensure a small gap between value and name */
            color: #fff;
        }

        .center {
            width: 150px;
            height: 150px;
            background-color: red;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px 10px rgba(255, 0, 0, 0.4), 0 0 40px 20px rgba(255, 0, 0, 0.2);
        }

        .top-left {
            width: 100px;
            height: 100px;
            top: 5%;
            left: 5%;
        }

        .top-right {
            width: 100px;
            height: 100px;
            top: 5%;
            right: 5%;
        }

        .bottom-left {
            width: 100px;
            height: 100px;
            bottom: 5%;
            left: 5%;
        }

        .bottom-right {
            width: 100px;
            height: 100px;
            bottom: 5%;
            right: 5%;
        }

        .status {
            font-size: 24px;
            text-align: center;
        }

        /* Updated styles */
        .aqi-container {
            position: relative;
            left:0px;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .center-circle {
    position: absolute;
    width: 170px;
    height: 170px;
    background-color: #e6e600;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #1d1d1d;
    font-weight: bold;
    box-shadow: 0 0 30px 30px rgba(230, 230, 0, 0.4), 0 0 40px 20px rgba(230, 230, 0, 0.2); /* Glow effect only on center circle */
}

        .aqi-item {
            position: absolute;
            width: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 18px;
            text-align: center;
        }

        .aqi-o3 {
            top: 10%;
            left: 10%;
        }

        .aqi-no2 {
            top: 10%;
            right: 10%;
        }

        .aqi-pm25 {
            bottom: 10%;
            left: 10%;
        }

        .aqi-pm10 {
            bottom: 10%;
            right: 10%;
        }

        .aqi-item span:nth-child(1) {
            font-size: 34px;
        }

        .aqi-item span:nth-child(2) {
            font-size: 14px;
        }

        .aqi-item span:nth-child(3) {
            font-size: 26px;
            color: #9b59b6;
        }

        /* Gauge chart container styles */
        .gauge-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    padding: 10px;
    background-color: #1d1d1d;
}

.gauge-item {
    width: 30%; /* Set width to approximately one-third of the container */
    background-color: #333;
    padding: 5px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    text-align: center;
}
.content-container{
    width:95%; /* Set width to approximately one-third of the container */
    background-color: #333;
    padding: 5px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    text-align: center;
}
.box-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    padding: 5px;
    background-color: #1d1d1d;
}
.box-item {
    /* Set width to approximately one-third of the container */
    background-color: #333;
    width: 30%; 
    padding: 7px 20px;
    cursor: pointer;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    text-align: center;
    text-decoration: none;
}
.box-item1 {
    /* Set width to approximately one-third of the container */
    background-color: #333;
    width: 10%; 
    padding: 7px 20px;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    text-align: center;
    text-decoration: none;
}
.box-item2 {
    /* Set width to approximately one-third of the container */
   
    width: 50%; 
    padding: 7px 5px;
   
    border-radius: 5px;
    cursor: pointer;
   
    text-align: center;
    text-decoration: none;
}
.gauge-item h3 {
    margin-bottom: 20px;
    color: #fff; /* Ensure the text color is visible against the background */
}
.breadcrumb-item a {
    color: inherit;
    text-decoration: inherit;
}
/* Glow Effect  */
.quality-card {
        width: 230px;
       
        padding: 10px 0px 2px 30px ;
        background-color:#00c853ce;/* Green background */
        color: white;
        border-radius: 10px;
        font-family: Arial, Helvetica, sans-serif;
        box-shadow:  0 0 30px #00c8539d; /* Green glow */
        text-align: left;
        font-size: 10px;
       letter-spacing: 2px;
       font-weight: bold;
    }
    .quality-card1 {
    width: 230px;
   padding:10px 0px 2px 30px;
    background-color:#e91e62c9; /* Pink background */
    color: white;
    border-radius: 10px;
    box-shadow:  0 0 30px #e91e629a; /* Pink glow */
    text-align: left;
    font-size: 10px;
    letter-spacing:2px;
    font-weight: bold;
}
.quality-card2 {
    width: 230px;
   padding:10px 0px 2px 30px;
    background-color:  #00ffff94; /* Aqua background */
    color: white;
    border-radius: 10px;
    box-shadow:  0 0 30px  #00ffff85; /* Aqua glow */
    text-align: left;
    font-size: 10px;
    letter-spacing:2px;
    font-weight: bold;
}
.quality-card3 {
    width: 230px;
   padding:10px 0px 2px 30px;
    background-color: #b3a102c4; /* Yellow background */
    color: white;
    border-radius: 10px;
    box-shadow:  0 0 30px  #ffeb3b9c; /* Yellow glow */
    text-align: left;
    font-size: 10px;
    letter-spacing:2px;
    font-weight: bold;
}
.quality-card4 {
    width: 230px;
   padding:10px 0px 2px 30px;
    background-color:  #ff9900d3;  /* Orange background */
    color: white;
    border-radius: 10px;
    box-shadow: 0 0 30px  #ff990094; /* Orange glow */
    text-align: left;
    font-size: 10px;
    letter-spacing:2px;
}
.quality-card5 {
    width: 230px;
   padding:10px 0px 2px 30px;
    background-color: #f44336da; /* Red background */
    color: white;
    border-radius: 10px;
    box-shadow:  0 0 30px  #f443367e; /* Red glow */
    text-align: left;
    font-size: 10px;
    letter-spacing:2px;
    font-weight: bold;
}

.box-item:hover {
            text-decoration: underline;
        }
.modal-backdrop {
            z-index: 1040 !important;
        }
        .modal-content {
            z-index: 1050 !important;
        }
    .title {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 10px;
    }


    .modal-content {
            background-color: #333;
            color: #fff;
            border: none;
        }
        .modal-header, .modal-footer {
            border: none;
        }
        .modal-header .close {
            color: #fff;
        }
        .modal-body .form-control {
            background-color: #444;
            color: #fff;
            border: 1px solid #555;
        }
        .modal-body .form-control::placeholder {
            color: #bbb;
        }
        .modal-body label {
            color: #ddd;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #004085;
        }


        .card {
  
   border-radius: 10px;
  
   margin: auto;
   background-color:#1d1d1d; /* Example background color */
   color: white; /* Ensure text is readable */
}

.card-body {
   padding: 20px;
}

    .card-title {
      margin-bottom: 20px;
      text-align: center;
      font-size: 1.5em;
    }

    #Historychart {
      max-width: 100%;
    }
   

    /* Billboard.js dark theme adjustments */

/* Hide legend if not needed */

    </style>
</head>

<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <img src="logo.png" alt="Company Logo" class="logo">
                <span class="company-name">AIR QUALITY MONITORING SYSTEM</span>
            </div>
            <div class="user-section">
                <div class="user-dropdown">
                    <div class="username me-3"><span id="">Hi Admin </span><i class=" fa fa-angle-down" aria-hidden="true"></i></div>
                    <div class="dropdown-content">
                        
                        <a href="index.html" >
                           Log Out
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <script>
        function decrypt(encryptedText, secretKey) {
            var bytes = CryptoJS.AES.decrypt(encryptedText, secretKey);
            return bytes.toString(CryptoJS.enc.Utf8);
        }

        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                username: params.get('username')
            };
        }

        document.addEventListener('DOMContentLoaded', function() {
            const { username } = getQueryParams();
            const secretKey = 'mySecretKey12345'; // Replace with your secret key

            const contentDiv = document.getElementById('content');

            try {
                const decryptedUsername = decrypt(username, secretKey);

                if (decryptedUsername === 'admin') {
                   // document.body.style.display = 'flex'; // Show the body
                  //  contentDiv.innerHTML = '<h1 class="authorized">Welcome, Admin!</h1><p>You are authorized to view this page.</p>';
                } else {
                    alert("You are not the right person to view this page.");
                    window.location.href = 'index.html'; // Redirect to login or another page
                }
            } catch (e) {
                alert("Invalid or tampered credentials.");
                window.location.href = 'index.html'; // Redirect to login or another page
            }
        });
    </script>
   <div class="box-container ">
   <div class="row  ps-3 ">
    <!-- <div class="box-item"> <ul class="breadcrumb">
                    <li class="breadcrumb-item mt-2"><a href="{{url('home')}}"><i class="fa fa-home me-2"></i> Home </a></i></li>
                    

</ul></div>
               <div class="box-item"> <div class=" mt-2"><a href="{{url('home')}}"><i class="fa fa-home me-2"></i> Home </a></i></div>
               </div> -->
              <div class="box-container">
                <div ><a  class="box-item"><i class="fa fa-home me-2" title="home"></i> Home </a></div>
               <!-- History Button -->
<div>
    <a class="box-item" data-toggle="modal" data-target="#historyModal">
        <i class="fa fa-history me-2" title="History"></i> History
    </a>
</div>
<div id="status-indicator"></div>

<!-- Updated time -->
<div>

</div>
<!-- Threshold Button -->
<div>
    <div class="box-item1" style="position:absolute;top:65px;right:30px;">
        <a class="" data-toggle="modal" data-target="#thresholdModal" style="text-decoration:none;">
            <i class="fa fa-cog me-2" title="Threshold"></i> Threshold
        </a>
    </div>
</div> </div>

            </div>
   </div>
 <!-- History Modal -->
 <div class="modal fade" id="historyModal" tabindex="-1" role="dialog" aria-labelledby="historyModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="historyModalLabel">History</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="Historyform">
                        <div class="mb-3">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="endDate" required>
                        </div>
                        
                        <button type="button" class="btn btn-danger" class="close" data-dismiss="modal">close</button>
                        <button type="reset" class="btn btn-warning">Clear</button>
                        <button type="submit" class="btn btn-success">Download CSV</button>
                    </form>
                    
                </div>
            </div>
        </div>
    </div>

    <!-- Threshold Modal -->
    <div class="modal fade" id="thresholdModal" tabindex="-1" role="dialog" aria-labelledby="thresholdModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="thresholdModalLabel">Set Threshold</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="ThresholdForm">
                        <div class="mb-2">
                            <label for="Temperature" class="form-label">Temperature </label>
                            <input type="number" class="form-control" id="Temperature" placeholder="Enter threshold for Temperature">
                        </div>
                        <div class="mb-2">
                            <label for="Humidity" class="form-label">Humidity </label>
                            <input type="number" class="form-control" id="Humidity" placeholder="Enter threshold for Humidity">
                        </div>
                        <div class="mb-2">
                            <label for="ammonia" class="form-label">Ammonia (NH₃)</label>
                            <input type="number" class="form-control" id="ammonia" placeholder="Enter threshold for Ammonia">
                        </div>
                        <div class="mb-2">
                            <label for="nitrogen" class="form-label">Nitrogen Oxides (NOₓ)</label>
                            <input type="number" class="form-control" id="nitrogen" placeholder="Enter threshold for Nitrogen Oxides">
                        </div>
                        <div class="mb-2">
                            <label for="alcohol" class="form-label">Alcohol</label>
                            <input type="number" class="form-control" id="alcohol" placeholder="Enter threshold for Alcohol">
                        </div>
                        <div class="mb-2">
                            <label for="benzene" class="form-label">Benzene</label>
                            <input type="number" class="form-control" id="benzene" placeholder="Enter threshold for Benzene">
                        </div>
                        <div class="mb-2">
                            <label for="smoke" class="form-label">Smoke</label>
                            <input type="number" class="form-control" id="smoke" placeholder="Enter threshold for Smoke">
                        </div>
                        <div class="mb-2">
                            <label for="co2" class="form-label">Carbon Dioxide (CO₂)</label>
                            <input type="number" class="form-control" id="co2" placeholder="Enter threshold for CO₂">
                        </div>
                        <button type="button" class="btn btn-danger" class="close" data-dismiss="modal">close</button>
                        <button type="reset" class="btn btn-warning">Clear</button>
                        <button type="submit" class="btn btn-primary">Set Threshold</button>
                    </form>
                    
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-4">
            <div class="container">
    <div class="aqi-container">
        <div class="center-circle" id="center-circle">
            <span id="aqi-status">Moderate</span>
        </div>
        <div class="aqi-item aqi-o3">
            <span id="aqi-o3-value">133</span>
            <span>µg/m³</span>
            <span>Co2</span>
        </div>
        <div class="aqi-item aqi-no2">
            <span id="aqi-no2-value">103</span>
            <span>µg/m³</span>
            <span>NH3</span>
        </div>
        <div class="aqi-item aqi-pm25">
            <span id="aqi-pm25-value">138</span>
            <span>µg/m³</span>
            <span>Smoke</span>
        </div>
        <div class="aqi-item aqi-pm10">
            <span id="aqi-pm10-value">526</span>
            <span>µg/m³</span>
            <span>NO2</span>
           
        </div>
    </div>
</div>

            </div>


            <div class="col-lg-8 ">
                <div class="content-container p-3">
                    <div class="box-item2" style="position:absolute;top:10px;right:60px;">
                        <a id="last-updated" style="text-decoration:none;">
                            Last Updated: <span id="date-time"></span>
                        </a>
                    </div>
                    <div class="row px-5 h3">
                        Air Index
                    </div>
                    <div class="row px-5">
                        <div class="col-lg-4">
                            <div class="quality-card">
                                <div class="title">Excellent</div>
                                <div class="content">
                                    <div>Alcohol</div>
                                    <div>0-2.0166</div>
                                    <div>Benzene</div>
                                    <div>0-1.15234</div>
                                    <div>CO2</div>
                                    <div>0-2.59277</div>
                                    <div>NH3</div>
                                    <div>0-2.88086</div>
                                    <div>NOx</div>
                                    <div>0-1.44043</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="quality-card1">
                                <div class="title">Good</div>
                                <div class="content">
                                    <div>Alcohol</div>
                                    <div>2.0167-4.0332</div>
                                    <div>Benzene</div>
                                    <div>1.15235-2.30468</div>
                                    <div>CO2</div>
                                    <div>2.59278-5.18554</div>
                                    <div>NH3</div>
                                    <div>2.88087-5.76172</div>
                                    <div>NOx</div>
                                    <div>1.44044-2.88086</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="quality-card2">
                                <div class="title">Fair</div>
                                <div class="content">
                                    <div>Alcohol</div>
                                    <div>4.0333-6.0498</div>
                                    <div>Benzene</div>
                                    <div>2.30469-3.45702</div>
                                    <div>CO2</div>
                                    <div>5.18555-7.77831</div>
                                    <div>NH3</div>
                                    <div>5.76173-8.64258</div>
                                    <div>NOx</div>
                                    <div>2.88087-4.32129</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3 px-5">
                        <div class="col-lg-4">
                            <div class="quality-card3">
                                <div class="title">Moderate</div>
                                <div class="content">
                                    <div>Alcohol</div>
                                    <div>6.0499-8.0664</div>
                                    <div>Benzene</div>
                                    <div>3.45703-4.60936</div>
                                    <div>CO2</div>
                                    <div>7.77832-10.37108</div>
                                    <div>NH3</div>
                                    <div>8.64259-11.52344</div>
                                    <div>NOx</div>
                                    <div>4.32130-5.76172</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="quality-card4">
                                <div class="title">Poor</div>
                                <div class="content">
                                    <div>Alcohol</div>
                                    <div>8.0665-10.0830</div>
                                    <div>Benzene</div>
                                    <div>4.60937-5.76170</div>
                                    <div>CO2</div>
                                    <div>10.37109-12.96385</div>
                                    <div>NH3</div>
                                    <div>11.52345-14.40430</div>
                                    <div>NOx</div>
                                    <div>5.76173-7.20215</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="quality-card5">
                                <div class="title">Very Poor</div>
                                <div class="content">
                                    <div>Alcohol</div>
                                    <div>10.0831+</div>
                                    <div>Benzene</div>
                                    <div>5.76171+</div>
                                    <div>CO2</div>
                                    <div>12.96386+</div>
                                    <div>NH3</div>
                                    <div>14.40431+</div>
                                    <div>NOx</div>
                                    <div>7.20216+</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            











        </div>
    </div>
<div class="row my-1 px-5 ">
    <div class="col-lg-8 col-md-12 ">
        <div class="card">
            <div class="card-body">
             
              <div id="Historychart" style="width: 100%; height: 100%;"></div>

            </div>
          </div>
    </div>
    <div class="col-lg-4 col-md-12">
        <div class="card">
            <div class="card-body">
                <div class="h4 ms-3 text-center">Temperature</div>
                <div class="row"> 
                    <div id="temperaturechart" style="width:100%;height:200px; background-color: #333; "></div>
                </div>
                <div class="h4 ms-3 text-center">Humidity</div>
                <div class="row">
                    
                    <div id="humiditychart"  style="width:100%;height:150px; background-color: #333; "></div>
                </div>
            </div>
        </div>
    </div>
    
</div>


    <div class="gauge-container">
        <div class="gauge-item">
            <h3>Carbon Dioxide</h3>
            <div class="chart-container"><div id="Carbon-Dioxide" class="chart"></div></div>
            
        </div>
        <div class="gauge-item">
            <h3>Nitragen Oxide</h3>
            <div class="chart-container"> <div id="Nitragen-Oxide" class="chart"></div></div>
        </div>
        <div class="gauge-item">
            <h3>Smoke</h3> 
            <div class="chart-container"> <div id="Smoke" class="chart"></div></div> 
        </div>
        <div class="gauge-item">
            <h3>Benzene</h3>
            <div class="chart-container"> <div id="Benzene" class="chart"></div></div>
        </div>
        <div class="gauge-item">
            <h3>Alcohol</h3>
            <div class="chart-container">   <div id="ALcohol" class="chart"></div></div>
        </div>
        <div class="gauge-item">
            <h3>Ammonia</h3>
            <div class="chart-container">    <div id="Ammonia" class="chart"></div></div>
        </div>
    </div>
<footer class="text-center text-white">&copy;All Rights Reserved By OLIVE IOT</footer>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@progress/kendo-ui/js/kendo.all.min.js"></script> -->

<script>
   
</script>
<!-- Add Firebase SDK -->
<script type="module">

    let globalData;
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getDatabase, set,ref, onValue } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";
  
    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDneqQZ9szh4daUFD1o1rsX0FCfGKPhGyY",
        authDomain: "air-quality-system-9a6c1.firebaseapp.com",
        databaseURL: "https://air-quality-system-9a6c1-default-rtdb.firebaseio.com",
        projectId: "air-quality-system-9a6c1",
        storageBucket: "air-quality-system-9a6c1.appspot.com",
        messagingSenderId: "1034056344108",
        appId: "1:1034056344108:web:ce1af9f288c85945e42789",
        measurementId: "G-MVVVFSTL9M"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
  
    // Reference to your sensorData node
    const sensorDataRef = ref(database, 'sensorData');

    document.addEventListener('DOMContentLoaded', function () {
        const gauges = {};

        function getRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function createGauge(elementId, value, max, label) {
            const chart = echarts.init(document.getElementById(elementId));
            const option = {
                tooltip: {
                    formatter: '{a} <br/>{b} : {c}' // Adjust this as needed
                },
                series: [
                    {
                        name: label, // Set the series name
                        type: 'gauge',
                        max: max, // Set the maximum value for the gauge
                        progress: {
                            show: true
                        },
                        detail: {
                            valueAnimation: true,
                            formatter: '{value}', // Adjust the formatter as needed
                            color: '#FFFFFF', // Set detail text color to white
                            offsetCenter: [0, '70%'], // Adjust the position of the value
                            fontSize: 30 // Increase font size if necessary
                        },
                        data: [
                            {
                                value: value,
                                name: label
                            }
                        ],
                        axisLine: {
                            lineStyle: {
                                color: [
                                    [0.25, '#FF6E76'],
                                    [0.5, '#FDDD60'],
                                    [0.75, '#58D9F9'],
                                    [1, '#7CFFB2']
                                ],
                                width: 6
                            }
                        },
                        pointer: {
                            length: '70%',
                            width: 8
                        },
                        axisLabel: {
                            color: '#FFFFFF' // Set axis labels color to white
                        },
                        title: {
                            show: true,
                            color: '#FFFFFF', // Set title text color to white
                            offsetCenter: [0, '120%'], // Position the label below the gauge
                            fontSize: 20 // Set font size for the label
                        }
                    }
                ]
            };
            chart.setOption(option);
            gauges[elementId] = chart; // Store the chart instance for future updates
        }
        
         

        function updateGauge(elementId, value) {
            const chart = gauges[elementId];
            const option = chart.getOption();
            option.series[0].data[0].value = parseFloat(value).toFixed(2); // Format value to 2 decimal places
            chart.setOption(option);
        }

        // Create initial gauges
        createGauge('Carbon-Dioxide', 1, 10, 'CO 2');
        createGauge('Nitragen-Oxide',  2, 10, 'NO 2');
        createGauge('Smoke',  1, 10, 'Smoke');
        createGauge('Benzene',1, 10, 'Benzene');
        createGauge('ALcohol', 0, 10, 'Alcohol');
        createGauge('Ammonia', 0, 10, 'Ammonia');

        // Listen for changes in sensorData and update the dashboard
        onValue(sensorDataRef, (snapshot) => {
           let data=snapshot.val();
            console.log(data);
            updateAQI(data);
            updateDashboard(data);
            updateDashboardTemp(data.temperature);
            updateDashboardHum(data.humidity);
        });

        // Function to update the dashboard
        function updateDashboard(data) {
            const rawTime = data.time; // "30-8-2024 16:16:11"
            const [day, month, yearAndTime] = rawTime.split('-');
            const [year, time] = yearAndTime.split(' ');
            const formattedTime = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}T${time}`;
            const lastUpdatedTime = new Date(formattedTime);
            const currentTime = new Date();
            
            console.log("Parsed Date:", lastUpdatedTime);
            console.log("Current Date:", currentTime);
            
            // Calculate the time difference in minutes
            const timeDifference = (currentTime - lastUpdatedTime) / 60000; // Difference in minutes
            
            const statusIndicator = document.getElementById('status-indicator');
            if (timeDifference <= 5) {
                // Online (within 5 minutes)
                statusIndicator.innerHTML = '<i class="fa-solid fa-circle" style="font-size:25px; color: #09ff00; box-shadow: 0px 0px 20px rgba(9, 255, 0, 0.7); border-radius: 50%;"></i>';
            } else {
                // Offline (greater than 5 minutes)
                statusIndicator.innerHTML = '<i class="fa-solid fa-circle" style="font-size:25px; color: #ff0000; box-shadow: 0px 0px 20px rgba(255, 0, 0, 0.7); border-radius: 50%;"></i>';
            }
            
            
            // Update the gauges
            updateGauge('Carbon-Dioxide', data.CO2, 10);
            updateGauge('Nitragen-Oxide', data.NOx, 10);
            updateGauge('Smoke', data.Smoke, 10);
            updateGauge('Benzene', data.Benzene, 10);
            updateGauge('ALcohol', data.Alcohol, 10);
            updateGauge('Ammonia', data.NH3, 10);
            
           
            document.getElementById('date-time').innerText = 'Last Updated: ' + data.time;
        }
        
    });



function updateDashboardTemp(data){
    var chart = bb.generate({
        data: {
            columns: [
                ["Temperature", 75] // Initial temperature value
            ],
            type: "gauge",
            onclick: function (d, i) {
                console.log("onclick", d, i);
            },
            onover: function (d, i) {
                console.log("onover", d, i);
            },
            onout: function (d, i) {
                console.log("onout", d, i);
            }
        },
        gauge: {
            label: {
                format: function (value, ratio) {
                    return value + " °C"; // Display temperature with unit
                }
            },
            min: 0, // Minimum temperature
            max: 100 // Maximum temperature
        },
        tooltip: {
            show: true,
            format: {
                value: function (value, ratio, id) {
                    return value + " °C"; // Tooltip value format
                }
            },
            contents: function (d, defaultTitleFormat, defaultValueFormat, color) {
                return `<div style="background-color: ${color(d[0])}; color: #000; padding: 5px; border-radius: 3px;">
                            <strong>${d[0].name}</strong><br>
                            ${d[0].value} °C
                        </div>`;
            }
        },
        color: {
            pattern: [


            "#60B044" ,
            "#F6C600",
            "#F97600",
                "#FF0000" 
               
            ],
            threshold: {
                values: [
                    40, // Adjust threshold values for temperature range
                    60,
                    90,
                    100
                ]
            }
        },
        size: {
            height: 180
        },
        bindto: "#temperaturechart" // Bind chart to a div with this ID
    });


setTimeout(function() {
    chart.load({
        columns: [["Temperature", data]]
    });
}, 1000);
}







function updateDashboardHum(data){
var chart1 = bb.generate({
    data: {
        columns: [
            ["Humidity", 55] // Initial humidity value
        ],
        type: "gauge",
        onclick: function (d, i) {
            console.log("onclick", d, i);
        },
        onover: function (d, i) {
            console.log("onover", d, i);
        },
        onout: function (d, i) {
            console.log("onout", d, i);
        }
    },
    gauge: {
        label: {
            format: function (value, ratio) {
                return value + " %"; // Display humidity with unit
            }
        },
        min: 0, // Minimum humidity
        max: 100 // Maximum humidity
    },
    tooltip: {
        show: true,
        format: {
            value: function (value, ratio, id) {
                return value + " %"; // Tooltip value format
            }
        },
        contents: function (d, defaultTitleFormat, defaultValueFormat, color) {
            return `<div style="background-color: ${color(d[0])}; color: #000; padding: 5px; border-radius: 3px;">
                        <strong>${d[0].name}</strong><br>
                        ${d[0].value} %
                    </div>`;
        }
    },
    color: {
        pattern: [
            
            "#FF0000" ,
            "#F97600", 
            "#F6C600", 
            "#60B044"        ],
        threshold: {
            values: [
                30, // Adjust threshold values for humidity range
                60,
                90,
                100
            ]
        }
    },
    size: {
        height: 180
    },
    bindto: "#humiditychart" // Bind chart to a div with this ID
});
setTimeout(function() {
    chart1.load({
        columns: [["Humidity", data]]
    });
}, 1000);
}










function updateAQI(data) {
    const alcohol = parseFloat(data.Alcohol).toFixed(2);
    const benzene = parseFloat(data.Benzene).toFixed(2);
    const co2 = parseFloat(data.CO2).toFixed(2);
    const nh3 = parseFloat(data.NH3).toFixed(2);
    const nox = parseFloat(data.NOx).toFixed(2);


    document.getElementById('aqi-o3-value').textContent = co2;
    document.getElementById('aqi-no2-value').textContent = nox;
    document.getElementById('aqi-pm25-value').textContent = nh3;
    document.getElementById('aqi-pm10-value').textContent = benzene;

    const aqiStatus = document.getElementById('aqi-status');
    const centerCircle = document.getElementById('center-circle');
    const aqiLevels = [alcohol, benzene, co2, nh3, nox];
    const maxAQI = Math.max(...aqiLevels);

    if (maxAQI <= 2) {
        aqiStatus.textContent = 'Excellent';
        centerCircle.style.backgroundColor = '#00c853ce';
        centerCircle.style.boxShadow = '0 0 30px 30px rgba(0, 200, 83, 0.4), 0 0 40px 20px rgba(0, 200, 83, 0.2)';
    } else if (maxAQI <= 4) {
        aqiStatus.textContent = 'Good';
        centerCircle.style.backgroundColor = '#e91e62c9';
        centerCircle.style.boxShadow = '0 0 30px 30px rgba(233, 30, 98, 0.4), 0 0 40px 20px rgba(233, 30, 98, 0.2)';
    } else if (maxAQI <= 6) {
        aqiStatus.textContent = 'Fair';
        centerCircle.style.backgroundColor = '#00ffff94';
        centerCircle.style.boxShadow = '0 0 30px 30px rgba(0, 255, 255, 0.4), 0 0 40px 20px rgba(0, 255, 255, 0.2)';
    } else if (maxAQI <= 8) {
        aqiStatus.textContent = 'Moderate';
        centerCircle.style.backgroundColor = '#ffeb3bc4';
        centerCircle.style.boxShadow = '0 0 30px 30px rgba(255, 235, 59, 0.4), 0 0 40px 20px rgba(255, 235, 59, 0.2)';
    } else if (maxAQI <= 10) {
        aqiStatus.textContent = 'Poor';
        centerCircle.style.backgroundColor = '#ff9900d3';
        centerCircle.style.boxShadow = '0 0 30px 30px rgba(255, 153, 0, 0.4), 0 0 40px 20px rgba(255, 153, 0, 0.2)';
    } else if (maxAQI > 10) {
        aqiStatus.textContent = 'Very Poor';
        centerCircle.style.backgroundColor = '#f44336da';
        centerCircle.style.boxShadow = '0 0 30px 30px rgba(244, 67, 54, 0.4), 0 0 40px 20px rgba(244, 67, 54, 0.2)';
    } else {
        aqiStatus.textContent = 'Excellent';
        centerCircle.style.backgroundColor = '#00c853ce';
        centerCircle.style.boxShadow = '0 0 30px 30px rgba(0, 200, 83, 0.4), 0 0 40px 20px rgba(0, 200, 83, 0.2)';
    }
}

document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('Historyform');

    form.addEventListener('submit', function (event) {
        event.preventDefault();

        // Get the selected values from the form
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        console.log(`Form submitted with startDate: ${startDate}, endDate: ${endDate}`);

        // Reference to your hourly data node
        const hourlyDataRef = ref(database, 'hourlyData');

        // Retrieve the data
        onValue(hourlyDataRef, (snapshot) => {
            const data = snapshot.val();
            console.log('Data retrieved from Firebase:', data);

            const csvData = [];
            const headers = ['Date', 'Time', 'Temperature', 'Humidity', 'CO2', 'Alcohol', 'Benzene', 'NH3', 'NOx', 'Smoke'];

            // Add header row to CSV data
            csvData.push(headers);

            // Iterate through the data to match the date range
            for (const dateKey in data) {
                if (data.hasOwnProperty(dateKey)) {
                    const entries = data[dateKey];
                    console.log(`Processing data for date: ${dateKey}`, entries);

                    // Convert dateKey from DD-MM-YYYY to YYYY-MM-DD for comparison
                    const [day, month, year] = dateKey.split('-');
                    const entryDate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    console.log(`Converted entryDate for comparison: ${entryDate}`);

                    if (entryDate >= startDate && entryDate <= endDate) {
                        console.log(`Date ${entryDate} is within the selected range.`);
                        for (const timeKey in entries) {
                            if (entries.hasOwnProperty(timeKey)) {
                                const entry = entries[timeKey];
                                console.log(`Processing time: ${timeKey}, Entry:`, entry);

                                csvData.push([
                                    entryDate,
                                    timeKey,
                                    entry.temperature, 
                                    entry.humidity, 
                                    entry.CO2,
                                    entry.Alcohol, 
                                    entry.Benzene, 
                                    entry.NH3, 
                                    entry.NOx, 
                                    entry.Smoke
                                ]);
                            }
                        }
                    } else {
                        console.log(`Date ${entryDate} is outside the selected range.`);
                    }
                }
            }

            // Log final CSV data array to the console
            console.log('Final CSV Data:', csvData);

            // Convert to CSV and trigger download
            if (csvData.length > 1) { // Ensure there is data to download
                downloadCSV(csvData);
            } else {
                console.log('No data found within the selected date range.');
                alert('No data found within the selected date range.');
            }
        });
    });

    function downloadCSV(data) {
        // Create a CSV string
        const csvString = data.map(row => row.join(',')).join('\n');

        // Create a blob and download the file
        const blob = new Blob([csvString], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = `data_${document.getElementById('startDate').value}_to_${document.getElementById('endDate').value}.csv`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);

        console.log('CSV file downloaded:', a.download);
    }
});




document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('ThresholdForm');

    form.addEventListener('submit', function (event) {
        event.preventDefault();

        // Get the values from the form fields
        const temperature = document.getElementById('Temperature').value;
        const humidity = document.getElementById('Humidity').value;
        const ammonia = document.getElementById('ammonia').value;
        const nitrogen = document.getElementById('nitrogen').value;
        const alcohol = document.getElementById('alcohol').value;
        const benzene = document.getElementById('benzene').value;
        const smoke = document.getElementById('smoke').value;
        const co2 = document.getElementById('co2').value;

        // Reference to the threshold node in Firebase
        const thresholdRef = ref(database, 'threshold');

        // Update the values in Firebase
        set(thresholdRef, {
            temperature: temperature,
            humidity: humidity,
            ammonia: ammonia,
            nitrogen: nitrogen,
            alcohol: alcohol,
            benzene: benzene,
            smoke: smoke,
            co2: co2
        }).then(() => {
            alert('Thresholds updated successfully!');
        }).catch((error) => {
            console.error('Error updating thresholds:', error);
        });
    });
});

function calculateAverage(data) {
    let sum = data.Alcohol + data.Benzene + data.CO2 + data.NH3 + data.NOx + data.Smoke;
    let average = sum / 6;
    return average;
}




    // Reference to your sensorData node
    const HourDataRef = ref(database, 'hourlyData');

    // Listen for data changes at the sensorData node
    onValue(HourDataRef, (snapshot) =>  {
    var hourlyData = snapshot.val();
    var seriesData = [];
    console.log(seriesData);

    Object.keys(hourlyData).forEach(date => {
        Object.keys(hourlyData[date]).forEach(hour => {
            let data = hourlyData[date][hour];
            let average = calculateAverage(data);

            // Assuming 'date' is in DD-MM-YYYY format and 'hour' is in 24-hour format
            let timestamp = new Date(`${date.split('-').reverse().join('-')}T${hour}:00:00`).getTime();

            seriesData.push({ x: timestamp, y: average });
        });
    });

    // Render the chart after data is retrieved
    var options = {
        series: [{
            name: 'Air Quality Index',
            data: seriesData
        }],
        chart: {
            type: 'line',
            height: 400,
            zoom: {
                enabled: true,
                type: 'x',
                autoScaleYaxis: true
            },
            toolbar: {
                autoSelected: 'zoom',
                tools: {
                    download: true,
                    selection: true,
                    zoom: true,
                    zoomin: true,
                    zoomout: true,
                    pan: true,
                    reset: true
                },
                background: '#000', // Black background for toolbar
            }
        },
        dataLabels: {
            enabled: false
        },
        markers: {
            size: 5,
        },
        title: {
            text: 'Air Quality Monitoring System',
            align: 'left',
            style: {
                fontSize: '18px',
                color: '#fff' // White title for visibility
            }
        },
        xaxis: {
            type: 'datetime',
            labels: {
                style: {
                    colors: ['#fff'], // White labels for visibility
                }
            }
        },
        yaxis: {
            labels: {
                formatter: function (val) {
                    return val.toFixed(2); // Display value as is without scaling
                },
                style: {
                    colors: ['#fff'], // White labels for visibility
                }
            },
            title: {
                text: 'Average Gas Concentration',
                style: {
                    color: '#fff' // White title for visibility
                }
            }
        },
        tooltip: {
            shared: false,
            y: {
                formatter: function (val) {
                    return val.toFixed(2);
                }
            }
        },
        theme: {
            mode: 'dark' // Use dark mode for the chart
        }
    };

    var chart = new ApexCharts(document.querySelector("#Historychart"), options);
    chart.render();
});


</script>





 
</body>

</html>
